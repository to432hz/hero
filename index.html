
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Strategy Archive – 닐리의 복잡계 초능력 실험실 (Single)</title>
  <meta name="color-scheme" content="light dark">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: {} }
    }
  </script>
  <style>
    :root { color-scheme: light dark; }
    html { background: #fafafa; color:#0a0a0a; }
    html.dark { background:#0a0a0a; color:#f4f4f5; }
    .container { max-width: 72rem; margin: 0 auto; }
    .card { border-radius: 1rem; border:1px solid rgb(226 232 240); background:#fff; padding:1rem; box-shadow: 0 1px 8px rgba(0,0,0,.04); }
    .dark .card { background:#0b0b0c; border-color: rgb(38 38 38); }
    .btn { display:inline-flex; align-items:center; gap:.5rem; border-radius:.75rem; border:1px solid rgb(203 213 225);
      background:#fff; padding:.5rem .75rem; font-size:.9rem; }
    .btn:hover { background:#fafafa; }
    .dark .btn { background:#121212; border-color:#404040; }
    .btn-ghost { border-color: transparent; background: transparent; }
    .btn-primary { background:#111827; color:white; }
    .dark .btn-primary { background:#e5e7eb; color:#0a0a0a; }
    .input { width:100%; border-radius:.75rem; border:1px solid rgb(203 213 225); background:#fff; padding:.5rem .75rem; font-size:.9rem; }
    .dark .input { background:#111; border-color:#404040; color:#e5e7eb; }
    .badge { display:inline-flex; align-items:center; border-radius:9999px; background: rgb(245 245 245); padding: 2px 8px; font-size:.75rem; color:#111827; }
    .dark .badge { background:#171717; color:#e5e7eb; }
    .badge-outline { border:1px solid rgb(203 213 225); background:transparent; color:#6b7280; }
    .dark .badge-outline { border-color:#404040; color:#d1d5db; }
    .hidden-mobile { display:none; }
    @media (min-width: 768px) { .hidden-mobile { display:block; } }
    .sticky-bar { position:fixed; left:0; right:0; bottom:0; z-index:50; border-top:1px solid rgb(229 231 235);
      background: rgba(255,255,255,.95); padding:.5rem; backdrop-filter: blur(8px); }
    .dark .sticky-bar { background: rgba(17,17,17,.95); border-color:#404040; }
  </style>
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- lucide icons -->
  <script type="module">
    import { Wand2, Search, Filter, Rocket, Smartphone, Settings, Download, Upload, MoreHorizontal, Star, Trash2, Tags, Calendar, Plus } from "https://unpkg.com/lucide@0.453.0/dist/esm/lucide.js";
    window.icons = { Wand2, Search, Filter, Rocket, Smartphone, Settings, Download, Upload, MoreHorizontal, Star, Trash2, Tags, Calendar, Plus };
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module">
    const { useEffect, useMemo, useRef, useState } = React;
    const I = window.icons;

    const STORAGE_KEY = "strategy-archive-v1";
    const nowISO = () => new Date().toISOString();
    const unique = (arr) => Array.from(new Set(arr));
    const clsx = (...a) => a.filter(Boolean).join(" ");
    const isNarrow = () => matchMedia && matchMedia("(max-width:768px)").matches;

    const seed = [
      { id: crypto.randomUUID?.() ?? String(Math.random()), title:"비틀기 (Twist)", category:"비틀기", domain:["연출","심리","시스템"],
        mechanism:"상황의 규칙 또는 기대를 일부 변형하여 비선형 반응을 유도한다. 예측가능성을 낮추고 주의를 재배치함으로써 상호작용의 에너지 흐름을 재조정.",
        triggers:"상대/환경이 관성적으로 움직일 때, 정보의 비대칭이 있을 때",
        steps:"1) 현재 규칙/기대치 식별 → 2) 작은 변형 포인트 선택 → 3) 시각/시간/행동 중 하나를 비틀어 신호 투입 → 4) 반응 관찰 및 2차 미세조정",
        counters:"일관성 체크리스트로 오용 방지. 변형 강도를 단계적으로(1→3단계) 올린다.",
        references:"복잡계/연출/심리학 사례집에서 수집 예정",
        status:"testing", confidence:62, tags:["확률증폭","연출"], pinned:true, lastTested:nowISO(), createdAt:nowISO(), updatedAt:nowISO() },
      { id: crypto.randomUUID?.() ?? String(Math.random()), title:"백신접종 (Vaccination)", category:"백신접종", domain:["리스크","시스템"],
        mechanism:"잠재 폭발을 미리 약하게 분산시켜 임계치 접근을 지연 또는 해소한다. 마이크로 이벤트로 에너지/긴장 해소.",
        triggers:"에너지 축적, 군집 심리 과열, 임계치 신호",
        steps:"1) 리스크 벡터 식별 → 2) 미세 자극/배출 채널 설계 → 3) 규칙적 소량 방출 실행 → 4) 임계치 신호 모니터",
        counters:"과도한 분산으로 동력 상실 주의. 목표 이벤트에서 분산 모드 OFF 스위치 명시.",
        references:"시스템 안전공학/행동경제 자료 레퍼런스 예정",
        status:"idea", confidence:48, tags:["리스크관리","분산"], pinned:false, createdAt:nowISO(), updatedAt:nowISO() },
    ];

    function Btn({ children, className, variant, ...rest }) {
      const variantCls = variant === "primary" ? "btn-primary" : variant === "ghost" ? "btn-ghost" : "";
      return React.createElement("button", { className: clsx("btn", variantCls, className), ...rest }, children);
    }
    function Input(props) { return React.createElement("input", { ...props, className: clsx("input", props.className) }); }
    function Badge({ children, outline }) { return React.createElement("span", { className: clsx("badge", outline && "badge-outline") }, children); }
    function Card({ children, className }) { return React.createElement("div", { className: clsx("card", className) }, children); }
    function guessDomains(arr){ return unique(arr.flatMap(s=>s.domain).concat(["양자","생물","시스템","게임이론","심리","디자인","경제","물리","화학"]).filter(Boolean)); }

    function App() {
      const [items, setItems] = useState(() => {
        try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : seed; } catch { return seed; }
      });
      const [query, setQuery] = useState("");
      const [status, setStatus] = useState("all");
      const [domainsFilter, setDomainsFilter] = useState([]);
      const [sortKey, setSortKey] = useState("updated");
      const [lite, setLite] = useState(false);
      const fileRef = useRef(null);

      useEffect(()=>localStorage.setItem(STORAGE_KEY, JSON.stringify(items)),[items]);
      useEffect(()=>{
        const qs = new URLSearchParams(location.search);
        if (["1","true"].includes(qs.get("lite"))) { setLite(true); return; }
        const upd = () => setLite(isNarrow());
        upd(); addEventListener("resize", upd); return ()=>removeEventListener("resize", upd);
      },[]);

      const filtered = useMemo(()=>{
        const q = query.trim().toLowerCase();
        return items
          .filter(it => status==="all" ? true : it.status===status)
          .filter(it => domainsFilter.length ? domainsFilter.every(d=>it.domain.includes(d)) : true)
          .filter(it => {
            if (!q) return true;
            const hay = [it.title,it.category,it.mechanism,it.triggers,it.steps,it.counters,it.references,it.tags.join(" "),it.domain.join(" ")].join(" ").toLowerCase();
            return hay.includes(q);
          })
          .sort((a,b)=>{
            if (sortKey==="confidence") return b.confidence - a.confidence;
            if (sortKey==="created") return +new Date(b.createdAt) - +new Date(a.createdAt);
            if (sortKey==="title") return a.title.localeCompare(b.title);
            return +new Date(b.updatedAt) - +new Date(a.updatedAt);
          });
      }, [items,query,status,domainsFilter,sortKey]);

      function onQuickAdd(title) {
        if (!String(title||"").trim()) return;
        const s = { id: crypto.randomUUID?.() ?? String(Math.random()), title: title.trim(), category:"미분류", domain:[], mechanism:"", triggers:"", steps:"", counters:"", references:"", status:"idea", confidence:30, tags:[], pinned:false, createdAt:nowISO(), updatedAt:nowISO() };
        setItems(prev=>[s,...prev]);
      }
      function exportJSON(){ const blob = new Blob([JSON.stringify(items,null,2)], {type:"application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "strategy-archive.json"; a.click(); URL.revokeObjectURL(url); }
      async function importJSON(fs) {
        const f = fs?.[0]; if(!f) return;
        const fr = new FileReader(); fr.onload=()=>{ try{ const data = JSON.parse(String(fr.result)); if(Array.isArray(data)) setItems(data); else alert("JSON 형식이 올바르지 않아요."); } catch(e){ alert("가져오기 실패: "+e.message); } }; fr.readAsText(f);
      }

      return (
        React.createElement("div", null,
          React.createElement("header", { className: "sticky top-0 z-40 border-b border-neutral-200 bg-white/80 backdrop-blur dark:border-neutral-800 dark:bg-neutral-950/80" },
            React.createElement("div", { className: "container flex items-center justify-between gap-3 p-4" },
              React.createElement("div", { className: "flex items-center gap-3" },
                React.createElement(window.icons.Wand2, { className:"h-5 w-5" }),
                React.createElement("h1",{className:"text-lg font-semibold"},"닐리의 전략 아카이브"),
                React.createElement("span",{className:"hidden-mobile badge"},"복잡계 초능력 실험실"),
                lite && React.createElement("span",{className:"badge badge-outline ml-1 inline-flex items-center gap-1"}, React.createElement(window.icons.Smartphone,{className:"h-3.5 w-3.5"}),"Lite")
              ),
              React.createElement("div",{className:"flex items-center gap-2"},
                React.createElement("button",{className:"btn btn-ghost", onClick:()=>{
                  const root=document.documentElement; const isDark=root.classList.toggle("dark"); localStorage.setItem("strategy-archive-theme", isDark? "dark":"light");
                }}, React.createElement(window.icons.Settings,{className:"h-4 w-4"}),"테마"),
                !lite && React.createElement(React.Fragment,null,
                  React.createElement("button",{className:"btn", onClick:exportJSON}, React.createElement(window.icons.Download,{className:"h-4 w-4"}),"내보내기"),
                  React.createElement("input",{type:"file", accept:"application/json", ref:fileRef, className:"hidden", onChange:e=>importJSON(e.target.files)}),
                  React.createElement("button",{className:"btn", onClick:()=>fileRef.current?.click()}, React.createElement(window.icons.Upload,{className:"h-4 w-4"}),"가져오기")
                )
              )
            ),
            lite && React.createElement("div",{className:"container px-4 pb-3 text-xs text-neutral-600 dark:text-neutral-300"},"모바일 라이트 모드: 빠른 캡처·검색·필터 가능, 상세 편집/가져오기/내보내기는 데스크톱에서.")
          ),
          React.createElement("main",{className:"container p-4 pb-24 md:pb-4"},
            React.createElement("div",{className:"card mb-4"},
              React.createElement("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between"},
                React.createElement("div",{className:"flex flex-1 items-center gap-2"},
                  React.createElement("div",{className:"relative w-full md:w-1/2"},
                    React.createElement(window.icons.Search,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral-400"}),
                    React.createElement(Input,{placeholder:"검색: 이름/도메인/태그/메커니즘…", className:"pl-9", value:query, onChange:e=>setQuery(e.target.value)})
                  ),
                  React.createElement("div",{className:"hidden-mobile"},
                    React.createElement("div",{className:"flex items-center gap-2"},
                      React.createElement(Btn,{onClick:()=>setStatus("all")}, React.createElement(window.icons.Filter,{className:"h-4 w-4"}),"전체"),
                      React.createElement(Btn,{onClick:()=>setStatus("idea")},"아이디어"),
                      React.createElement(Btn,{onClick:()=>setStatus("testing")},"테스트중"),
                      React.createElement(Btn,{onClick:()=>setStatus("proven")},"검증됨"),
                    )
                  )
                ),
                React.createElement("div",{className:"flex w-full items-center gap-2 md:w-auto"},
                  React.createElement(Input,{placeholder:"빠른 캡처: 전략 이름", onKeyDown:e=>{ if(e.key==="Enter"){ onQuickAdd(e.currentTarget.value); e.currentTarget.value=""; } }}),
                  React.createElement("button",{className:"btn", onClick:()=>{ const el=document.activeElement; const val=(el && 'value' in el)? el.value : ""; onQuickAdd(val); if (el && 'value' in el) el.value=""; }}, React.createElement(window.icons.Plus,{className:"h-4 w-4"})," 추가")
                )
              ),
              React.createElement("hr",{className:"my-3 border-neutral-200 dark:border-neutral-800"}),
              React.createElement("div",{className:"flex flex-wrap items-center gap-2 text-sm text-neutral-500 dark:text-neutral-400"},
                React.createElement("span",{className:"flex items-center gap-1"}, React.createElement(window.icons.Rocket,{className:"h-4 w-4"})," 전체 ", items.length,"개"),
                React.createElement("span",null,"|"),
                React.createElement("span",null,"도메인: ", guessDomains(items).length,"종")
              )
            ),
            filtered.length===0
              ? React.createElement("div",{className:"card border-dashed text-center"},
                  React.createElement("p",{className:"mb-1 text-sm"},"아직 전략이 없어요."),
                  React.createElement("p",{className:"mb-4 text-xs text-neutral-500"},"위의 \"빠른 캡처\"에 이름을 입력하거나, 아래 버튼으로 새 전략을 추가하세요."),
                  React.createElement("button",{className:"btn btn-primary", onClick:()=>onQuickAdd("무제 전략")}, React.createElement(window.icons.Plus,{className:"h-4 w-4"})," 새 전략 추가")
                )
              : React.createElement("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3"},
                  filtered.map(s=>React.createElement(StrategyCard,{
                    key:s.id, data:s,
                    onRemove:()=>setItems(prev=>prev.filter(i=>i.id!==s.id)),
                    onInlineUpdate:(p)=>setItems(prev=>prev.map(i=>i.id===s.id?{...i, ...p, updatedAt:nowISO()}:i))
                  }))
                )
          ),
          lite && React.createElement("div",{className:"sticky-bar md:hidden"},
            React.createElement("div",{className:"container flex items-center gap-2"},
              React.createElement(Input,{placeholder:"전략 이름 빠른 캡처", onKeyDown:(e)=>{ if(e.key==="Enter"){ onQuickAdd(e.currentTarget.value); e.currentTarget.value=""; } }}),
              React.createElement("button",{className:"btn", onClick:()=>{ const el=document.activeElement; const val=(el && 'value' in el)? el.value : ""; onQuickAdd(val); if (el && 'value' in el) el.value=""; }},"추가")
            )
          )
        )
      );
    }

    function StrategyCard({ data, onRemove, onInlineUpdate }) {
      const statusColor = {
        idea: "bg-amber-100 text-amber-900 dark:bg-amber-900/30 dark:text-amber-200",
        testing: "bg-blue-100 text-blue-900 dark:bg-blue-900/30 dark:text-blue-200",
        proven: "bg-emerald-100 text-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-200",
      };
      return React.createElement(Card,{className:"relative"},
        React.createElement("div",{className:"flex items-start justify-between gap-2"},
          React.createElement("div",{className:"min-w-0"},
            React.createElement("div",{className:"truncate text-base font-semibold"}, data.title),
            React.createElement("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-neutral-500 dark:text-neutral-400"},
              React.createElement(Badge,null, data.category || "미분류"),
              React.createElement("span",{className:"truncate"}, data.domain.join(" · "))
            )
          ),
          React.createElement("div",{className:"flex items-center gap-1"},
            React.createElement("span",{className:clsx("badge", statusColor[data.status])}, data.status),
            React.createElement("div",{className:"relative"},
              React.createElement("details", null,
                React.createElement("summary",{className:"list-none cursor-pointer inline-flex"}, "⋯"),
                React.createElement("div",{className:"absolute right-0 z-20 mt-1 w-28 rounded-xl border bg-white p-1 text-sm shadow-lg dark:border-neutral-700 dark:bg-neutral-800"},
                  React.createElement("button",{className:"w-full rounded-lg px-2 py-1 text-left hover:bg-neutral-100 dark:hover:bg-neutral-700", onClick:()=>onInlineUpdate({ pinned: !data.pinned })},"핀 고정"),
                  React.createElement("button",{className:"w-full rounded-lg px-2 py-1 text-left text-red-600 hover:bg-neutral-100 dark:hover:bg-neutral-700", onClick:onRemove},"삭제")
                )
              )
            )
          )
        ),
        data.mechanism && React.createElement("div",{className:"mt-2"},
          React.createElement("div",{className:"mb-1 flex items-center gap-2 text-xs font-medium text-neutral-600 dark:text-neutral-300"},"메커니즘"),
          React.createElement("p",{className:"line-clamp-3 whitespace-pre-wrap leading-relaxed"}, data.mechanism)
        ),
        React.createElement("div",{className:"mt-3 grid grid-cols-2 gap-3"},
          data.triggers && React.createElement("div",null, React.createElement("div",{className:"mb-1 text-xs font-medium"},"트리거"), React.createElement("p",null,data.triggers)),
          data.steps && React.createElement("div",null, React.createElement("div",{className:"mb-1 text-xs font-medium"},"스텝"), React.createElement("p",null,data.steps))
        ),
        React.createElement("div",{className:"mt-2 flex flex-wrap gap-2"}, data.tags.map(t=>React.createElement(Badge,{key:t, outline:true},"#",t))),
        React.createElement("div",{className:"mt-3 flex items-center justify-between text-xs text-neutral-500 dark:text-neutral-400"},
          React.createElement("div",{className:"flex items-center gap-2"},
            React.createElement("span",{className:"rounded-full bg-neutral-100 px-2 py-0.5 dark:bg-neutral-800"},"신뢰도 ", data.confidence,"%"),
            data.lastTested && React.createElement("span",null,new Date(data.lastTested).toLocaleDateString())
          ),
          React.createElement("div",{className:"flex items-center gap-2"},
            React.createElement("select",{className:"input h-8 w-28", value:data.status, onChange:e=>onInlineUpdate({ status: e.target.value })},
              React.createElement("option",{value:"idea"},"아이디어"),
              React.createElement("option",{value:"testing"},"테스트중"),
              React.createElement("option",{value:"proven"},"검증됨")
            ),
            React.createElement("input",{type:"range", min:0, max:100, className:"h-2 w-24", value:data.confidence, onChange:e=>onInlineUpdate({ confidence: Number(e.target.value) })})
          )
        )
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
