<!doctype html>
<html lang="ko"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>닐리의 전략 아카이브 (Mini)</title>
<style>
:root{color-scheme:light dark;--bg:#fff;--fg:#0a0a0a;--muted:#6b7280;--card:#fff;--line:#e5e7eb}
@media(prefers-color-scheme:dark){:root{--bg:#0b0b0c;--fg:#f5f5f5;--muted:#cbd5e1;--card:#111113;--line:#30363d}}
*{box-sizing:border-box}html,body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
.container{max-width:880px;margin:0 auto;padding:16px}
header{position:sticky;top:0;z-index:5;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
@media(prefers-color-scheme:dark){header{background:rgba(17,17,17,.9)}}
h1{margin:0;font-size:18px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
input,button{font:inherit}
input[type=text]{flex:1;min-width:140px;border:1px solid var(--line);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 10px}
button{border:1px solid var(--line);background:var(--card);color:var(--fg);border-radius:10px;padding:8px 12px;cursor:pointer}
button.primary{background:#111827;color:#fff;border-color:#111827}
button.danger{color:#b91c1c;border-color:#b91c1c}
.muted{color:var(--muted)}.card{border:1px solid var(--line);background:var(--card);border-radius:14px;padding:12px}
.grid{display:grid;grid-template-columns:1fr;gap:10px}@media(min-width:700px){.grid{grid-template-columns:1fr 1fr}}
.tag{display:inline-block;border:1px solid var(--line);border-radius:999px;padding:2px 8px;margin-right:6px;font-size:12px}
.empty{border:1px dashed var(--line);text-align:center;padding:24px;border-radius:14px}
.toolbar{display:flex;gap:8px;align-items:center}.right{margin-left:auto}
</style></head>
<body>
<header><div class="container row" style="padding:10px 16px">
  <h1>닐리의 전략 아카이브</h1><span class="muted">mini</span>
  <div class="right toolbar">
    <button id="btnExport">내보내기(JSON)</button>
    <input id="fileIn" type="file" accept="application/json" style="display:none">
    <button id="btnImport">가져오기</button>
  </div>
</div></header>

<main class="container" style="padding-top:12px">
  <div class="row" style="margin-bottom:10px">
    <input id="q" type="text" placeholder="검색: 제목/태그">
  </div>
  <div class="row" style="margin-bottom:10px">
    <input id="title" type="text" placeholder="빠른 캡처: 전략 제목">
    <input id="tags" type="text" placeholder="태그(쉼표로 구분)" style="flex:0 1 260px">
    <button id="btnAdd" class="primary">추가</button>
  </div>
  <div id="stats" class="muted" style="margin:8px 0 14px"></div>
  <div id="list" class="grid"></div>
  <div id="empty" class="empty" style="display:none">
    아직 전략이 없어요. 위의 입력창에 제목을 적고 <b>추가</b>를 눌러봐!
  </div>
</main>

<script>
const KEY="strategy-archive-mini-v1";
const seed=[
  {id:uid(),title:"비틀기 (Twist)",tags:["연출","심리","시스템"],note:"기대/규칙을 살짝 변형해 비선형 반응 유도",createdAt:now()},
  {id:uid(),title:"백신접종 (Vaccination)",tags:["리스크","시스템"],note:"작은 방출로 임계 접근을 지연",createdAt:now()},
];
function uid(){return (crypto.randomUUID&&crypto.randomUUID())||(Date.now()+"-"+Math.random().toString(16).slice(2))}
function now(){return new Date().toISOString()}
function load(){try{const raw=localStorage.getItem(KEY);return raw?JSON.parse(raw):seed}catch{return seed}}
function save(d){localStorage.setItem(KEY,JSON.stringify(d))}
let items=load();
const els={q:byId("q"),title:byId("title"),tags:byId("tags"),list:byId("list"),empty:byId("empty"),stats:byId("stats"),
  btnAdd:byId("btnAdd"),btnExport:byId("btnExport"),btnImport:byId("btnImport"),fileIn:byId("fileIn")};
function byId(id){return document.getElementById(id)}
function esc(s){return String(s).replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]))}
function render(){
  const q=(els.q.value||"").trim().toLowerCase();
  const filtered=!q?items:items.filter(it=>(it.title||"").toLowerCase().includes(q)||(it.tags||[]).join(" ").toLowerCase().includes(q));
  els.stats.textContent=`전체 ${items.length}개 · 검색결과 ${filtered.length}개`;
  els.empty.style.display=filtered.length?"none":"block";
  els.list.innerHTML="";
  filtered.forEach(it=>{
    const card=document.createElement("div");card.className="card";
    card.innerHTML=`<div class="row" style="align-items:flex-start">
      <div style="flex:1;min-width:0">
        <div style="font-weight:600;word-break:break-word">${esc(it.title)}</div>
        ${it.note?`<div class="muted" style="margin-top:4px">${esc(it.note)}</div>`:""}
        <div style="margin-top:8px">${(it.tags||[]).map(t=>`<span class="tag">#${esc(t)}</span>`).join(" ")}</div>
        <div class="muted" style="margin-top:6px;font-size:12px">${new Date(it.createdAt).toLocaleString()}</div>
      </div>
      <div class="toolbar">
        <button data-act="edit" data-id="${it.id}">수정</button>
        <button class="danger" data-act="del" data-id="${it.id}">삭제</button>
      </div>
    </div>`;
    els.list.appendChild(card);
  });
}
els.btnAdd.onclick=()=>{const title=(els.title.value||"").trim();if(!title)return alert("제목을 입력해줘!");
  const tags=(els.tags.value||"").split(",").map(s=>s.trim()).filter(Boolean);
  items=[{id:uid(),title,tags,note:"",createdAt:now()},...items];save(items);els.title.value="";els.tags.value="";render();}
els.q.oninput=()=>render();
els.list.addEventListener("click",e=>{
  const btn=e.target.closest("button");if(!btn)return;
  const id=btn.getAttribute("data-id");const act=btn.getAttribute("data-act");
  const idx=items.findIndex(i=>i.id===id);if(idx<0)return;
  if(act==="del"){if(confirm("삭제할까?")){items.splice(idx,1);save(items);render();}}
  if(act==="edit"){const t=prompt("제목 수정",items[idx].title);if(t===null)return;
    const tg=prompt("태그 수정(쉼표 구분)",(items[idx].tags||[]).join(", "));
    items[idx].title=(t||"").trim()||items[idx].title;items[idx].tags=(tg||"").split(",").map(s=>s.trim()).filter(Boolean);
    save(items);render();}
});
els.btnExport.onclick=()=>{const blob=new Blob([JSON.stringify(items,null,2)],{type:"application/json"});
  const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="strategy-archive.json";a.click();URL.revokeObjectURL(url);}
els.btnImport.onclick=()=>els.fileIn.click();
els.fileIn.onchange=(ev)=>{const f=ev.target.files[0];if(!f)return;const fr=new FileReader();
  fr.onload=()=>{try{const data=JSON.parse(fr.result);if(!Array.isArray(data))throw new Error("배열(JSON array)이어야 해");
  items=data.map(x=>({id:x.id||uid(),title:x.title||"",tags:x.tags||[],note:x.note||"",createdAt:x.createdAt||now()}));save(items);render();}
  catch(err){alert("가져오기 실패: "+err.message)}};fr.readAsText(f);}
render();
</script>
</body></html>
